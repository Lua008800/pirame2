<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ferramenta de Implantação de Produtos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center h-screen">
    <div class="text-center p-8 bg-gray-800 rounded-lg shadow-2xl max-w-lg">
        <h1 class="text-3xl font-bold text-blue-400 mb-4">Ferramenta de Implantação</h1>
        <p class="text-gray-400 mb-6">Use isto apenas uma vez para configurar os produtos na base de dados `itambe1`. Certifique-se de que as suas regras do Firestore estão temporariamente abertas.</p>
        
        <div class="space-y-4">
            <button id="delete-button" class="w-full bg-red-600 text-white font-bold py-3 px-6 rounded-md hover:bg-red-700 transition-colors">
                Passo 1: Apagar Produtos Antigos
            </button>
            <button id="deploy-button" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-md hover:bg-blue-700 transition-colors">
                Passo 2: Adicionar 30 Novos Produtos
            </button>
        </div>
        <p id="status-message" class="mt-6 text-sm"></p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getFirestore, collection, writeBatch, getDocs, doc } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

        // **NOVA CONFIGURAÇÃO DO FIREBASE (PROJETO itambe1)**
        const firebaseConfig = {
            apiKey: "AIzaSyAAcSljFY_EZnNZyeDlRD_A5Ac6xMdlfYI",
            authDomain: "itambe1.firebaseapp.com",
            projectId: "itambe1",
            storageBucket: "itambe1.appspot.com", // Formato correto
            messagingSenderId: "994625835321",
            appId: "1:994625835321:web:a778e249b04671e83c98e8",
            measurementId: "G-JP3BRJYES3"
        };

        let db;
        const deleteButton = document.getElementById('delete-button');
        const deployButton = document.getElementById('deploy-button');
        const statusMessage = document.getElementById('status-message');

        try {
             const app = initializeApp(firebaseConfig);
             db = getFirestore(app);
             console.log("Firebase inicializado com sucesso.");
             statusMessage.textContent = 'Firebase ligado. Pronto a implantar.';
             statusMessage.classList.add('text-green-500');
        } catch (initError) {
             console.error("Erro CRÍTICO na inicialização do Firebase:", initError);
             statusMessage.textContent = `Erro GRAVE ao inicializar o Firebase. Verifique a firebaseConfig e o console (F12).`;
             statusMessage.classList.add('text-red-500');
             if(deployButton) deployButton.disabled = true;
             if(deleteButton) deleteButton.disabled = true;
        }

        // Listener para o Botão de Apagar
        if (db) {
            deleteButton.addEventListener('click', async () => {
                if (!confirm("Tem a certeza de que quer apagar TODOS os produtos existentes?")) {
                    return;
                }
                
                deleteButton.disabled = true;
                deployButton.disabled = true;
                statusMessage.textContent = 'A apagar produtos antigos...';
                statusMessage.classList.remove('text-red-500', 'text-green-500', 'text-yellow-500');

                try {
                    const productsRef = collection(db, "products");
                    const oldProductsSnapshot = await getDocs(productsRef);
                    const deleteBatch = writeBatch(db);
                    
                    if(oldProductsSnapshot.empty) {
                        statusMessage.textContent = 'Nenhum produto antigo encontrado para apagar.';
                        statusMessage.classList.add('text-yellow-500');
                        console.log("Nenhum produto antigo encontrado.");
                        deleteButton.disabled = false;
                        deployButton.disabled = false;
                        return;
                    }

                    oldProductsSnapshot.forEach(doc => {
                        deleteBatch.delete(doc.ref);
                    });
                    await deleteBatch.commit();
                    
                    console.log("Produtos antigos apagados com sucesso.");
                    statusMessage.textContent = 'Produtos antigos apagados com sucesso. Pode avançar para o Passo 2.';
                    statusMessage.classList.add('text-green-500');
                } catch (error) {
                    console.error("Erro ao apagar produtos:", error);
                    statusMessage.textContent = `Erro ao apagar: ${error.message}`;
                    statusMessage.classList.add('text-red-500');
                }
                deleteButton.disabled = false;
                deployButton.disabled = false;
            });

            // Listener para o Botão de Criar
            deployButton.addEventListener('click', async () => {
                deleteButton.disabled = true;
                deployButton.disabled = true;
                statusMessage.textContent = 'A criar 30 novos produtos...';
                statusMessage.classList.remove('text-red-500', 'text-green-500', 'text-yellow-500');

                try {
                    const newBatch = writeBatch(db);
                    const productDetails = [
                        { name: "Iogurte Natural Cremoso" }, { name: "Iogurte Grego com Mel" },
                        { name: "Iogurte Skyr Proteico" }, { name: "Iogurte Kefir de Frutas" },
                        { name: "Iogurte Desnatado Leve" }, { name: "Iogurte Integral Tradicional" },
                        { name: "Iogurte com Morango" }, { name: "Iogurte com Pêssego" },
                        { name: "Bebida Láctea Zero Lactose" }, { name: "Sobremesa Láctea com Aveia" },
                        { name: "Iogurte Grego Frutas Vermelhas" }, { name: "Iogurte Kids Maçã e Banana" },
                        { name: "Bebida Láctea de Coco" }, { name: "Iogurte Tradicional com Polpa" },
                        { name: "Iogurte Light de Ameixa" }, { name: "Iogurte Natural Consistente" },
                        { name: "Iogurte Grego Baunilha" }, { name: "Iogurte Skyr Morango" },
                        { name: "Iogurte Kefir Natural" }, { name: "Bebida Láctea Desnatada com Fibras" },
                        { name: "Iogurte Integral Cremoso" }, { name: "Iogurte com Maracujá" },
                        { name: "Iogurte com Abacaxi" }, { name: "Bebida Láctea Zero Adição de Açúcar" },
                        { name: "Sobremesa Láctea com Granola" }, { name: "Iogurte Grego Tradicional" },
                        { name: "Iogurte Kids Uva" }, { name: "Bebida Láctea de Pêssego" },
                        { name: "Iogurte com Calda de Frutas" }, { name: "Sobremesa Láctea Light com Mel" }
                    ];
                    
                    const prices = [
                        40, 80, 150, 200, 300, 400, 450, 500, 550, 600, 
                        650, 700, 750, 800, 900, 1000, 1100, 1200, 1300, 1400,
                        1500, 1600, 1700, 1800, 2000, 2200, 2400, 2600, 2800, 3000
                    ];

                    for (let i = 0; i < 30; i++) {
                        const price = prices[i];
                        const totalReturn = price * 11;
                        const dailyReturn = totalReturn / 100;

                        const newProduct = {
                            name: productDetails[i].name,
                            price: price,
                            totalReturn: totalReturn,
                            dailyReturn: dailyReturn,
                            cycleDays: 100,
                            imageUrl: `https://placehold.co/600x400/1F2937/9CA3AF?text=${encodeURIComponent(productDetails[i].name)}`
                        };

                        const newDocRef = doc(collection(db, "products"));
                        newBatch.set(newDocRef, newProduct);
                    }

                    await newBatch.commit();
                    
                    statusMessage.textContent = 'Sucesso! 30 novos produtos foram cadastrados.';
                    statusMessage.classList.add('text-green-500');
                    deployButton.textContent = 'Concluído!';
                    console.log("30 novos produtos cadastrados com sucesso.");

                } catch (error) {
                    console.error("Erro ao implantar produtos:", error);
                    statusMessage.textContent = `Erro ao implantar. Verifique o console (F12) para mais detalhes. Detalhes: ${error.message}`;
                    statusMessage.classList.add('text-red-500');
                    deployButton.disabled = false;
                }
            });
        }
    </script>
</body>
</html>

